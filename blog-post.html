<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post | EveryAI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_live_Y2xlcmsuZXZlcnktYWkuY29tJA"
        src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>
    <style>
        .post-page {
            padding: 140px 20px 80px;
            background: var(--bg-base);
            min-height: 100vh;
        }

        .post-container {
            max-width: 850px;
            margin: 0 auto;
            background: var(--bg-surface);
            padding: 60px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        @media (max-width: 768px) {
            .post-container {
                padding: 30px 20px;
            }
        }

        /* ── Header ── */
        .post-header {
            margin-bottom: 40px;
            text-align: left;
        }

        .post-title {
            font-family: var(--font-head);
            font-size: 2.8rem;
            line-height: 1.2;
            color: var(--text-primary);
            margin-bottom: 20px;
            white-space: pre-wrap;
            /* Preserve spaces/newlines */
        }

        .post-meta {
            font-size: 0.95rem;
            color: var(--text-muted);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .post-meta span {
            display: flex;
            align-items: center;
        }

        .post-meta span::after {
            content: "/";
            margin-left: 10px;
        }

        .post-meta span:last-child::after {
            display: none;
        }

        .post-intro {
            font-size: 1.2rem;
            line-height: 1.6;
            color: var(--text-primary);
            margin-bottom: 30px;
            font-style: italic;
            white-space: pre-wrap;
            /* Preserve spaces/newlines */
        }

        /* ── Content ── */
        .post-body {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .post-body p {
            margin-bottom: 25px;
        }

        .post-body h2 {
            font-family: var(--font-head);
            font-size: 2rem;
            color: var(--text-primary);
            margin: 40px 0 20px;
        }

        .post-body h3 {
            font-family: var(--font-head);
            font-size: 1.4rem;
            color: var(--text-primary);
            margin: 30px 0 15px;
        }

        .post-body ul {
            margin-bottom: 25px;
            padding-left: 20px;
        }

        .post-body li {
            margin-bottom: 15px;
        }

        /* ── FAQs ── */
        .faq-item {
            margin-bottom: 30px;
        }

        .faq-q {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .faq-a {
            color: var(--text-secondary);
        }

        /* ── Content Tables ── */
        .post-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 35px 0;
            font-size: 0.95rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
            background: var(--bg-surface);
            white-space: normal;
            /* Override post-body pre-wrap */
        }

        .post-body table tr,
        .post-body table th,
        .post-body table td {
            white-space: normal;
        }

        .post-body th,
        .post-body td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        .post-body th:last-child,
        .post-body td:last-child {
            border-right: none;
        }

        .post-body th {
            background: rgba(92, 184, 92, 0.04);
            font-family: var(--font-head);
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
        }

        .post-body td {
            color: var(--text-secondary);
            line-height: 1.6;
            vertical-align: top;
        }

        .post-body tr:last-child td {
            border-bottom: none;
        }

        .post-body tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.01);
        }

        body.light .post-body tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.005);
        }

        @media (max-width: 600px) {
            .post-body table {
                display: block;
                overflow-x: auto;
            }
        }

        /* ── Navigation ── */
        .post-navigation {
            display: flex;
            justify-content: space-between;
            padding-top: 40px;
            margin-top: 60px;
            border-top: 1px solid var(--border);
            font-size: 0.95rem;
            font-weight: 600;
        }

        .nav-link-post {
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .nav-link-post:hover {
            color: var(--accent-1);
        }

        /* ── Related Posts ── */
        .related-section {
            margin-top: 60px;
            background: var(--bg-base);
            padding: 40px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
        }

        .related-section h2 {
            font-family: var(--font-head);
            font-size: 1.8rem;
            margin-bottom: 30px;
        }

        .related-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 600px) {
            .related-grid {
                grid-template-columns: 1fr;
            }
        }

        .related-item h3 {
            font-size: 1rem;
            line-height: 1.4;
            color: var(--text-secondary);
        }

        /* ── Comment Section ── */
        .comment-section {
            margin-top: 60px;
        }

        .comment-section h2 {
            font-family: var(--font-head);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .comment-note {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .comment-form {
            display: grid;
            gap: 20px;
        }

        .comment-textarea {
            width: 100%;
            padding: 15px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-base);
            color: var(--text-primary);
            min-height: 200px;
            resize: vertical;
        }

        .comment-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 600px) {
            .comment-inputs {
                grid-template-columns: 1fr;
            }
        }

        .comment-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: var(--radius-sm);
            border: 3px solid var(--border);
            background: var(--bg-base);
            color: var(--text-primary);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .btn-subscribe {
            background: #ff5252;
            color: white;
            padding: 10px 24px;
            border-radius: var(--radius-full);
            font-weight: 700;
            text-decoration: none;
            transition: var(--transition);
        }

        .btn-subscribe:hover {
            filter: brightness(1.1);
        }

        /* ── Share Buttons ── */
        .share-btns {
            display: flex;
            gap: 15px;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px dashed var(--border);
        }

        .share-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: var(--radius-full);
            background: var(--bg-surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .share-btn.twitter:hover {
            color: #1da1f2;
            border-color: #1da1f2;
            background: rgba(29, 161, 242, 0.1);
        }

        .share-btn.linkedin:hover {
            color: #0077b5;
            border-color: #0077b5;
            background: rgba(0, 119, 181, 0.1);
        }

        /* ── Light Mode Specifics ── */
        body.light .post-container {
            background: #ffffff;
        }

        body.light .comment-input {
            border-color: #f0f0f0;
        }
    </style>
    <link rel="icon" type="image/png"
        href="https://res.cloudinary.com/dhar8ajns/image/upload/v1772261620/b6e4b2aa-4284-4a0d-9603-4bae72ffb715_gq7kqd.png">
</head>

<body id="body">
    <!-- ── Premium Background Elements ── -->
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <!-- ── Navbar ── -->
    <nav class="navbar" id="navbar">
        <div class="nav-inner">
            <a href="index.html" class="logo" id="logo-link">
                <span class="logo-icon"><img
                        src="https://res.cloudinary.com/dhar8ajns/image/upload/v1772261620/b6e4b2aa-4284-4a0d-9603-4bae72ffb715_gq7kqd.png"
                        alt="EveryAI Logo" class="logo-img"></span>
                <span class="logo-text">Every<span class="logo-accent">AI</span></span>
            </a>

            <ul class="nav-links" id="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="about.html" class="nav-link">About</a></li>
                <li><a href="blogs.html" class="nav-link">Blogs</a></li>
                <li><a href="prompts.html" class="nav-link">Prompts</a></li>
                <li><a href="contact.html" class="nav-link">Contact Us</a></li>
            </ul>

            <div class="nav-actions">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="theme-toggle" aria-label="Toggle theme">
                        <input type="checkbox" id="theme-toggle" />
                        <div class="slider-round">
                            <div class="knob"></div>
                        </div>
                    </label>
                </div>
                <a href="submit.html" class="btn-primary" id="nav-cta">Submit Tool</a>
                <button id="sign-in-btn" class="btn-login" style="display: none;">Login</button>
                <div id="user-button"></div>
            </div>

            <button class="hamburger" id="hamburger" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </nav>

    <!-- ── Mobile Menu ── -->
    <div class="mobile-menu" id="mobile-menu">
        <a href="index.html" class="mobile-link">Home</a>
        <a href="about.html" class="mobile-link">About</a>
        <a href="blogs.html" class="mobile-link">Blogs</a>
        <a href="prompts.html" class="mobile-link">Prompts</a>
        <a href="contact.html" class="mobile-link">Contact Us</a>
        <div id="mobile-user-button"></div>
        <button id="mobile-sign-in-btn" class="mobile-link" style="display: none;">Login</button>
        <a href="submit.html" class="btn-primary mobile-cta">Submit Tool</a>
    </div>

    <main class="post-page">
        <article class="post-container" id="post-content">
            <!-- Loading state -->
            <div style="text-align: center; padding: 100px 0;">
                <p>Loading post content...</p>
            </div>
        </article>
    </main>

    <!-- ── Footer ── -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <span class="logo-icon"><img
                                src="https://res.cloudinary.com/dhar8ajns/image/upload/v1772261620/b6e4b2aa-4284-4a0d-9603-4bae72ffb715_gq7kqd.png"
                                alt="EveryAI Logo" class="logo-img"></span>
                        <span class="logo-text">Every<span class="logo-accent">AI</span></span>
                    </a>
                    <p class="footer-tagline">The ultimate directory of AI-powered tools and apps.</p>
                </div>

                <div class="footer-links-group">
                    <h4>Directory</h4>
                    <a href="index.html#apps">All Tools</a>
                    <a href="categories.html">All Categories</a>
                    <a href="submit.html">Submit App</a>
                    <a href="admin.html" id="admin-dashboard-link" style="display: none;">Admin Dashboard</a>
                </div>

                <div class="footer-links-group">
                    <h4>Company</h4>
                    <a href="index.html">Home</a>
                    <a href="about.html">About</a>
                    <a href="blogs.html">Blogs</a>
                    <a href="prompts.html">Prompts</a>
                    <a href="contact.html">Contact Us</a>
                </div>

                <div class="footer-links-group">
                    <h4>Legal</h4>
                    <a href="privacy-policy.html">Privacy Policy</a>
                    <a href="terms-of-service.html">Terms of Service</a>
                    <a href="cookie-policy.html">Cookie Policy</a>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2026 EveryAI. All rights reserved.</p>
                <p>Built with ❤️ for the AI community</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { convex } from './convex-client.js';
        /**
         * formatBlogContent
         * Converts plain-text blog content into proper HTML:
         *  - Detects table blocks (rows where columns are separated by 2+ spaces or tabs)
         *    and converts them into styled <table> elements.
         *  - Wraps headings (lines that look like titles) in <h2>/<h3>.
         *  - Wraps everything else in <p> tags.
         * This lets us remove white-space:pre-wrap from .post-body so tables render.
         */
        function formatBlogContent(raw) {
            if (!raw) return raw;

            // If the content already contains HTML tags, return as-is
            if (/<(h[1-6]|p|table|ul|ol|div|section|article)\b/i.test(raw)) {
                return raw;
            }

            const TABLE_COL = /^.+(?:  {2,}|\t).+/;
            const lines = raw.split('\n');
            const blocks = [];
            let i = 0;

            while (i < lines.length) {
                const line = lines[i];
                const trimmed = line.trim();

                // Skip blank lines
                if (!trimmed) { i++; continue; }

                // ── Detect table block (2+ consecutive table-like lines) ──────
                if (TABLE_COL.test(trimmed)) {
                    const tableLines = [];
                    while (i < lines.length) {
                        const t = lines[i].trim();
                        if (t === '') { i++; break; }
                        if (TABLE_COL.test(t)) { tableLines.push(lines[i]); i++; }
                        else break;
                    }

                    if (tableLines.length >= 2) {
                        const rows = tableLines.map(l =>
                            l.trim().split(/\t|  {2,}/).map(c => c.trim()).filter(Boolean)
                        );
                        let html = '<table><thead><tr>';
                        rows[0].forEach(cell => html += `<th>${cell}</th>`);
                        html += '</tr></thead><tbody>';
                        for (let r = 1; r < rows.length; r++) {
                            html += '<tr>';
                            rows[r].forEach((cell, ci) => {
                                html += ci === 0
                                    ? `<td style="font-weight:700;color:var(--accent-1)">${cell}</td>`
                                    : `<td>${cell}</td>`;
                            });
                            html += '</tr>';
                        }
                        html += '</tbody></table>';
                        blocks.push(html);
                    } else {
                        tableLines.forEach(l => blocks.push(`<p>${l.trim()}</p>`));
                    }
                    continue;
                }

                // ── Heading detection: ALL CAPS short line, or ends with colon ─
                if (/^[A-Z][A-Z\s\u2013\u2014&:]{5,50}$/.test(trimmed) || (trimmed.endsWith(':') && trimmed.length < 60 && !trimmed.includes('.'))) {
                    blocks.push(`<h2>${trimmed}</h2>`);
                    i++;
                    continue;
                }

                // ── Subheading: starts with Q: or A: ─────────────────────────
                if (/^Q:/.test(trimmed)) {
                    blocks.push(`<p class="faq-q">${trimmed}</p>`);
                    i++; continue;
                }
                if (/^A:/.test(trimmed)) {
                    blocks.push(`<p class="faq-a">${trimmed}</p>`);
                    i++; continue;
                }

                // ── Bullet / arrow point ──────────────────────────────────────
                if (/^[→\-*•]/.test(trimmed)) {
                    // Collect all consecutive bullet lines
                    const bullets = [];
                    while (i < lines.length && /^[→\-*•]/.test(lines[i].trim())) {
                        bullets.push(`<li>${lines[i].trim().replace(/^[→\-*•]\s*/, '')}</li>`);
                        i++;
                    }
                    blocks.push(`<ul>${bullets.join('')}</ul>`);
                    continue;
                }

                // ── Default: plain paragraph ──────────────────────────────────
                blocks.push(`<p>${trimmed}</p>`);
                i++;
            }

            return blocks.join('\n');
        }

        // Load Post Content
        async function loadPost() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            const container = document.getElementById('post-content');

            // Default Post Content
            const defaultPost = {
                title: "A Beginner's Guide to Using AI Writing Prompts",
                meta: "Leave a Comment / AI / By everyai.com@gmail.com",
                intro: "This beginner's guide will help you understand how to use AI writing prompts to generate unique ideas for your writing projects and unlock your full creative potential.",
                body: `
                    <h2>Introduction</h2>
                    <p>Writing is an essential skill that has been around since the dawn of civilization...</p>
                `
            };

            let post = defaultPost;
            let prevLink = '#', nextLink = '#';
            let prevStyle = 'opacity:0.5; pointer-events:none;', nextStyle = 'opacity:0.5; pointer-events:none;';

            // Check if it's a dynamic post from admin
            if (slug) {
                try {
                    const found = await convex.query("blogs:getBlogBySlug", { slug });

                    if (found) {
                        let finalBody = found.content;
                        if (found.contentUrl) {
                            console.log("Fetching large content from storage...");
                            const response = await fetch(found.contentUrl);
                            finalBody = await response.text();
                        }

                        // Convert plain-text tables → HTML tables
                        finalBody = formatBlogContent(finalBody);

                        post = {
                            title: found.title,
                            meta: `Admin / ${new Date(found.timestamp).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: '2-digit' })} / ${found.category}`,
                            intro: found.excerpt,
                            body: finalBody,
                            imageUrl: found.imageUrl,
                            keywords: ''
                        };

                        // Navigation Logic requires the full list to find neighbors
                        const allBlogs = await convex.query("blogs:getBlogs");
                        const foundIndex = allBlogs.findIndex(b => b.slug === slug);

                        // Navigation Logic
                        // Older post (Previous)
                        if (foundIndex < allBlogs.length - 1) {
                            prevLink = `blog-post.html?slug=${allBlogs[foundIndex + 1].slug}`;
                            prevStyle = '';
                        }
                        // Newer post (Next)
                        if (foundIndex > 0) {
                            nextLink = `blog-post.html?slug=${allBlogs[foundIndex - 1].slug}`;
                            nextStyle = '';
                        }

                        document.title = `${post.title} | EveryAI`;
                    }
                } catch (e) { console.error("Could not fetch blog", e); }
            }

            container.innerHTML = `
                <a href="blogs.html" style="display:inline-flex; align-items:center; gap:8px; color:var(--text-muted); font-size:0.9rem; font-weight:600; text-decoration:none; margin-bottom:28px; transition:var(--transition);"
                   onmouseover="this.style.color='var(--accent-1)'" onmouseout="this.style.color='var(--text-muted)'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to Blogs
                </a>

                <h1 class="post-title">${post.title}</h1>
                <div class="post-meta">${post.meta}</div>
                <div class="post-intro">${post.intro}</div>
                ${post.imageUrl ? `
                <div class="post-featured-image" style="margin-bottom: 40px; border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--border);">
                    <img src="${post.imageUrl}" alt="${post.title}" style="width: 100%; height: auto; display: block; object-fit: contain; max-height: 500px;">
                </div>
                ` : ''}
                <div class="post-body">${post.body}</div>
                <div class="share-btns">
                    <button class="share-btn twitter" aria-label="Share on X" onclick="window.open('https://twitter.com/intent/tweet?url='+encodeURIComponent(window.location.href),'_blank', 'width=550,height=420')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.004 3.936H5.039z"/></svg>
                    </button>
                    <button class="share-btn linkedin" aria-label="Share on LinkedIn" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url='+encodeURIComponent(window.location.href),'_blank', 'width=550,height=420')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                    </button>
                </div>

                <div class="post-navigation">
                    <a href="${prevLink}" class="nav-link-post" style="${prevStyle}">← Previous Post</a>
                    <a href="${nextLink}" class="nav-link-post" style="${nextStyle}">Next Post →</a>
                </div>

                <section class="related-section">
                    <h2>Related Posts</h2>
                    <div class="related-grid" id="related-posts-grid">
                        <div class="related-item"><h3>Loading related stories...</h3></div>
                    </div>
                </section>

                <section class="comment-section">
                    <h2>Leave a Comment</h2>
                    <p class="comment-note">Your email address will not be published. Required fields are marked *</p>

                    <div id="comment-success" style="display:none; background: rgba(92,184,92,0.1); border: 1px solid var(--accent-1); border-radius: var(--radius-md); padding: 16px 20px; margin-bottom: 20px; color: var(--accent-1); font-weight: 600;">
                        ✅ Message sent! Thank you for your comment.
                    </div>

                    <form class="comment-form" id="comment-form">
                        <textarea class="comment-textarea" id="comment-text" placeholder="Type here.." required></textarea>
                        <div class="comment-inputs">
                            <input type="text" class="comment-input" id="comment-name" placeholder="Name*" required>
                            <input type="email" class="comment-input" id="comment-email" placeholder="Email*" required>
                            <input type="text" class="comment-input" id="comment-website" placeholder="Website">
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="save-info">
                            <label for="save-info">Save my name, email, and website in this browser for the next time I comment.</label>
                        </div>
                        <button type="submit" class="btn-primary" id="comment-submit-btn" style="padding: 12px 32px; width: fit-content;">POST COMMENT »</button>
                    </form>
                </section>
            `;

            // Load Related Posts (Simplified: just show latest 2 other posts)
            try {
                const allBlogs = await convex.query("blogs:getBlogs");
                const otherBlogs = allBlogs.filter(b => b.slug !== slug).sort(() => 0.5 - Math.random()).slice(0, 2);
                const relatedGrid = document.getElementById('related-posts-grid');
                if (otherBlogs.length > 0) {
                    relatedGrid.innerHTML = otherBlogs.map(b => `
                        <div class="related-item">
                            <a href="blog-post.html?slug=${b.slug}" style="text-decoration:none; color:inherit;">
                                <h3 style="cursor:pointer; transition:0.2s;" onmouseover="this.style.color='var(--accent-1)'" onmouseout="this.style.color='var(--text-secondary)'">${b.title}</h3>
                            </a>
                        </div>
                    `).join('');
                } else {
                    relatedGrid.innerHTML = '<p>Check back for more stories soon!</p>';
                }
            } catch (e) { }
        }

        loadPost().then(() => {
            // ── Comment Form Handler ─────────────────────────────────────
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug') || 'default';

            // Auto-fill saved info
            const saved = JSON.parse(localStorage.getItem('commentInfo') || '{}');
            if (saved.name) { const n = document.getElementById('comment-name'); if (n) n.value = saved.name; }
            if (saved.email) { const e = document.getElementById('comment-email'); if (e) e.value = saved.email; }
            if (saved.website) { const w = document.getElementById('comment-website'); if (w) w.value = saved.website; }

            document.addEventListener('submit', async (e) => {
                const form = e.target;
                if (!form || form.id !== 'comment-form') return;
                e.preventDefault();

                const btn = document.getElementById('comment-submit-btn');
                const name = document.getElementById('comment-name')?.value.trim();
                const email = document.getElementById('comment-email')?.value.trim();
                const website = document.getElementById('comment-website')?.value.trim();
                const comment = document.getElementById('comment-text')?.value.trim();
                const saveInfo = document.getElementById('save-info')?.checked;

                if (!name || !email || !comment) return;

                btn.disabled = true;
                btn.textContent = 'Sending...';

                try {
                    // Get blog title if available
                    let blogTitle = document.querySelector('.post-title')?.textContent || slug;

                    await convex.mutation('comments:postComment', {
                        name, email,
                        website: website || undefined,
                        comment,
                        blogSlug: slug,
                        blogTitle,
                        timestamp: new Date().toISOString(),
                    });

                    // Save info to localStorage if checkbox checked
                    if (saveInfo) {
                        localStorage.setItem('commentInfo', JSON.stringify({ name, email, website }));
                    }

                    // Show success
                    const success = document.getElementById('comment-success');
                    if (success) success.style.display = 'block';
                    form.reset();
                    // Re-fill saved info
                    if (saveInfo) {
                        document.getElementById('comment-name').value = name;
                        document.getElementById('comment-email').value = email;
                        if (website) document.getElementById('comment-website').value = website;
                    }
                } catch (err) {
                    alert('Failed to post comment. Please try again.');
                    console.error(err);
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'POST COMMENT »';
                }
            });
        });
    </script>
    <script type="module" src="app.js"></script>
</body>

</html>